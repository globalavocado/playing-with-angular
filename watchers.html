<html ng-app=''>

<head>
	<title>observing model changes</title>
	<link rel="stylesheet" href="css/foundation.css">
</head>

	<body>
		<div class='pagination-centered'>
			<h2>your shopping trolley</h2>
		
				<div ng-controller="CartController"> 
					<div ng-repeat="item in items">
						<span>{{item.title}}</span>
						<input ng-model="item.quantity">
						<span class="green">{{item.price | currency:"&pound;"}}</span> 
						<span>{{item.price * item.quantity | currency:"&pound;"}}</span>
					</div>
					
					<div>subtotal: {{subtotal() | currency:"&pound;"}}</div>
					<div><span class="red">discount: - {{bill.discount | currency:"&pound;"}}</span></div> 
					<div><b>total: {{totalCart() | currency:"&pound;"}}</b></div> 
				</div>
		</div>

		<script type="text/javascript" src="js/angular.js"></script> 
	
		<script>
			function CartController($scope) {
		      $scope.bill = {};
		      $scope.items = [
		        {title: 'Paint pots', quantity: 8, price: 3.95},
		        {title: 'Polka dots', quantity: 17, price: 12.95},
		        {title: 'Pebbles', quantity: 5, price: 6.95}
			];
				$scope.subtotal = function() {
					var total = 0;
					for (var i = 0, len = $scope.items.length; i < len; i++) {
					          total = total + $scope.items[i].price * $scope.items[i].quantity;
					        }
					return total; 
				}
				
				$scope.totalCart = function() {
					return $scope.subtotal() - $scope.bill.discount;
					};
					
					function calculateDiscount(newValue, oldValue, scope) { 
						$scope.bill.discount = newValue > 100 ? 10 : 0;
						}
				      $scope.$watch($scope.totalCart, calculateDiscount);
			    }

	</script>

	</body>
</html>